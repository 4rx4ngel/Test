# Руководство по работе с Git

## Введение
Git — один из видов систем контроля версий (или СКВ). Такие системы записывают изменения в набор файлов, а позже позволяют вернуться к определенной версии.
Вам может пригодиться СКВ, если вы, например, программист, системный администратор, дизайнер (или в целом работаете с массивом изменяющихся файлов) и хотите сохранить каждую версию проекта. Вы сможете вернуться к любому из сохраненных состояний, просмотреть изменения и увидеть их авторов. Так гораздо проще исправлять возникающие проблемы.

В целом СКВ можно разделить таким образом:

1. Локальные — все файлы хранятся только в вашей операционной системе, например, разложены по папкам с версиями. 
2. Централизованные — проект хранится на сервере, а ваша рабочая версия включает только текущий набор файлов.
3. Распределенные — копии проекта (и вся информация о версиях) располагаются не только на сервере, но и на нескольких клиентских машинах, чтобы обеспечить устойчивость к отказу сервера.
   
Очевидно, что Git — не единственная система контроля версий, однако по многим параметрам самая удобная и популярная на сегодняшний день. Благодаря распределенной структуре репозитории Git хранятся на всех клиентских компьютерах, что защищает от потерь данных и позволяет полноценно управлять версиями проекта оффлайн.

Главная отличительная черта Git состоит в подходе к обработке данных. Каждый раз при сохранении данных проекта (коммите) система фиксирует состояние файла (делает снимок) и создает ссылку на этот снимок. Последующие изменения отражаются через ссылки на более ранние версии файла. Нет необходимости снова сохранять файл целиком. К тому же, основываясь на контрольных hash-суммах, система снимков обеспечивает целостность всей истории изменений. На практике это означает, что невозможно (либо крайне трудно) полностью удалить данные из рабочего каталога и утратить к ним любой доступ. В большинстве случаев данные можно восстановить из ранней версии проекта.

Таким образом, систему контроля версий в Git проще всего представлять как поток снимков (сохраненных состояний проекта).

## Принципы работы с Git
У проектных файлов в Git есть 3 базовых состояния

* Измененные (modified) — файлы в процессе рабочего редактирования.
* Индексированные (staged) — та часть измененных файлов, которая уже подготовлена к фиксации после редактирования.
* Зафиксированные (committed) — файлы, уже сохраненные в локальном репозитории.

У Git есть рабочий каталог, где хранятся метаданные и локальная база рабочего проекта. Именно эта часть копируется, когда вы **клонируете** проект (репозиторий) с сервера.

Чаще всего работа с Git устроена примерно так:

1. Вы вносите правки в файлы рабочей копии проекта.
2. Индексируете их, подготавливая к коммиту (здесь Git создает снимки новых правок).
3. Делаете коммит, и индексированные правки наконец сохраняются в вашем каталоге Git.

# Установка Git
Создать свой проект и начать пользоваться Git в нем достаточно просто. Мы будем рассматривать работу в командной строке терминала, потому что там реализован полный набор команд. Вероятно, в будущем вам будет проще воспользоваться встроенными инструментами в крупном приложении.

Однако командная строка все равно удобна для тонкой настройки и «нестандартных» действий, поэтому полезно представлять себе, как управлять проектом через нее.

Сначала потребуется установить Git на свой компьютер. 

### Установка на Linux
Для дистрибутивов, похожих на Fedora, RHEL или CentOS, выполните команду dnf:


> **\> sudo dnf install git-all**

На Ubuntu и других Debian-подобных систем введите apt:

> **\> sudo apt install git**

Более подробные сведения можно получить по ссылке: [Git for Linux](https://git-scm.com/download/linux).

### Установка на Mac
Один из способов установки — воспользоваться Xcode Command Line Tools. В терминале нужно ввести:

> **\> git --version**

И следовать дальнейшим инструкциям.

Если вы пользуетесь Homebrew, запустите команду:


> **$ brew install git**

Подробности доступны по ссылке: [Git for Mac](https://git-scm.com/download/mac)

### Установка в Windows
Новейшая сборка доступна на официальном сайте Git по ссылке:
[Download Git for Windows](https://git-scm.com/download/win "Нажми меня, чтобы скачать Git for Windows")

# Настройка Git

Настроить рабочую среду нужно только один раз — после обновлений параметры не сбросятся. Если понадобится, в любое время можно изменить ваши настройки.

Самый удобный способ изменения конфигурации — встроенная утилита **git config**. Настройки Git имеют три уровня:

1. Параметры из файла **[path]/etc/gitconfig** (системные) могут работать для всех пользователей системы и репозиториев. Они редактируются командой **git config —system**.
2. Параметры из файла **~/.gitconfig** или **~/.config/git/config** (глобальные) применяются к одному пользователю, если запустить команду **git config —global**.
3. Локальные параметры из файла **config** в рабочем каталоге **.git/config** сохраняют только для выбранного репозитория. Ему соответствует команда **git config —local**.
   
Если запускать **git config** без параметров, будет использоваться локальный уровень, никакие из более глобальных настроек не изменятся.

Всю используемую конфигурацию можно просмотреть так:

> **\> git config --list --show-origin**

Представимся Git, чтобы в рабочих коммитах сохранялось ваше авторство:
> **\> git config --global user.name "Your name"  
> \> git config --global user.email Your email**

# Выбор ветки по умолчанию
Итак, наконец можно создать репозиторий в выбранном каталоге командой **git init**. Основная ветка автоматически будет названа _master_. Изменить это (в нашем случае задав ветку _main_) можно так:

> **\> git config --global init.defaultBranch main**

# Работа в репозитории

Как правило, есть два варианта начать работу с репозиторием Git:

1. Можно выбрать локальный каталог и создать новый репозиторий в нем.
2. Можно клонировать существующий репозиторий с локального компьютера или сервера. Обычно проекты клонируются именно с сервера.

Если у вас на компьютере уже есть рабочий проект, но еще не назначен контроль версий, то нужно сначала перейти в каталог проекта.

Linux:

> **\> cd /home/user/SomeConsoleApp**

macOS:

> **\> cd /Users/user/SomeConsoleApp**

Windows:

> **\> cd C:/Users/user/SomeConsoleApp**

Инициализируем репозиторий:

> **\> git init**

Команда создаст каталог с именем **.git**, в котором будут храниться структурные файлы репозитория. 

И, наконец, нужно добавить под контроль версий все существующие файлы командой **git add .** (**точка в конце важна!**). Можно добавлять и по одному файлу, с помощью **git add <имя файла>**. 

Заодно создадим начальный коммит командой **git commit**:

> **\> git add readme.md  
> \> git commit -m 'Initial project version'**

Команду git add можно гибко настраивать с помощью дополнительных параметров (флагов), которые подробно описаны в [официальной документации](https://git-scm.com/docs/git-add). К примеру, команда **git add —force** добавит даже игнорируемые файлы, а **git add —update** позволит обновить отслеживаемые файлы.

В этом репозитории вы можете продолжать работать и дальше, со временем обновляя его и отправляя рабочие версии на сервер.

# Клонирование существующего репозитория
Когда вы работаете в команде, разрабатываемые проекты часто размещают на сервере. Это один из самых распространенных сценариев. Вам нужно получить копию проекта последней версии на свой компьютер, чтобы далее вносить в него свой вклад.

В качестве примера мы будем рассматривать проект, который создадим на ресурсе https://github.com/ . После регистрации на сайте и подтверждения по e-mail нужно создать новый репозиторий, как показано на скриншотах.

![](https://lh4.googleusercontent.com/wfq_jJuMFhK5PFagnDbtGK5YfxV5BC4cYgyILYTFZ4apmWZwV3m5DZsjwLXLCYzAOr8AvuNxadL167F2Rlf-3ju9Tas1U63BFoo5C4msQWDjo6-CEmA53gZKXc6P5IqpBQXNsK3q=s0)  

![](https://lh5.googleusercontent.com/hrE-moWlE_6-ZD5sSm8cB1UrwtJ22tT1rWt0GK0li0roskZZdJ-3WRnP2uhlkfziw2weVlF3IcVSBeii5gERu_UJ2LIfLVhBf5gj4F4W4_mXtS54Y9tkjneCb6WfCUALn-EQnfCn=s0)

Видно, что можно выбрать тип репозитория:

* публичный (public) – доступ открыт для любого пользователя, однако права на редактирование выдает владелец проекта;
* приватный/скрытый (private) — проект виден только владельцу, другие участники добавляются вручную.
  
Для нашего примера создадим приватный репозиторий под названием SomeConsoleApp и будем работать с ним далее.

Самые удобные способы клонирования проекта — через протоколы HTTP и SSH, прочесть обо всех более развёрнуто можно по [ссылке](https://git-scm.com/book/en/v2/Git-on-the-Server-The-Protocols).

Для наших целей воспользуемся протоколом https и следующей командой:

> **\> git clone https://github.com/DanZDev2/SomeConsoleApp  SomeConsoleApp**

На вашем компьютере в каталоге, куда вы перешли в командной строке, должен появиться каталог SomeConsoleApp, внутри него — каталог .git и все скачанные файлы репозитория последней версии.

После получения проекта обычно начинается более рутинный рабочий процесс — правки, добавление функционала и т. д. Далее в какой-то момент вы захотите сохранить прогресс в новой версии проекта.

Правила и периодичность обновления могут быть почти любыми, но хорошим тоном обычно считается сохранять рабочую (или промежуточно завершенную) версию. Важное требование для команд разработчиков — возможность сборки проекта, иначе другие участники команды будут вынуждены тратить время на борьбу с ошибками компиляции.

# Сохранение снимков и просмотр статуса проекта
Как упоминалось ранее, часть файлов в рабочем каталоге может и не находиться под контролем версий. За отслеживаемыми файлами «наблюдает» Git, они были как минимум в прошлом снимке состояния проекта. Неотслеживаемыми могут быть, например, вспомогательные файлы в рабочем проекте, если они не зафиксированы в прошлой версии проекта и не готовы к коммиту. Их можно выделить в отдельную категорию для Git, о чем будет рассказано далее.

Сразу после клонирования все файлы проекта будут отслеживаемыми. Отредактировав их и привнеся что-то новое, вы индексируете (**stage**) и фиксируете (**commit**) правки, и так для каждой версии проекта.

При этом нужно внимательно следить, чтобы вспомогательные файлы, особенно объемные, оставались вне контроля версий. Если по недосмотру добавить их в коммит и отправить на сервер — вероятнее всего, ваши правки придется частично откатывать.

Проверить состояние файлов в рабочем каталоге можно командой **git status**. После клонирования консоль выведет примерно такую информацию:

> **On branch master  
 Your branch is up to date with ‘origin/master’.    
 nothing to commit, working tree clean**

Теперь отредактируем файлы (в этом примере было консольное демо-приложение, созданное с помощью Visual Studio) и сравним статус:

> **git status     
On branch master    
Your branch is up to date with ‘origin/master’.     
Untracked files:    
(use “git add <file>...” to include in what will be committed)  
	Program.cs  
	SomeConsoleApp.csproj   
	SomeConsoleApp.sln  
nothing added to commit but untracked files present (use “git add” to track)**

Теперь зафиксируем изменения. В коммит войдут только те файлы, которые вы изменили и добавили командой git add. Остальные будут лишь дополнительными файлами в каталоге проекта.

Стандартный способ — команда git commit, которую мы уже видели раньше. Без дополнительных аргументов она откроет встроенный текстовый редактор, поэтому для простоты рекомендуется добавить аргумент -m и вписать комментарий в кавычках:

> **\> git commit -m "Task 2: basic project template added"**

Для удаления ненужных файлов из репозитория можно использовать команду **git rm <Имя файла>**. Файл также пропадет из рабочего каталога. Выполнить коммит необходимо и в этом случае; до тех пор структура проекта не изменится.
